<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun-FP-JS Browser Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 2rem;
        }

        .test {
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-radius: 4px;
        }

        .pass {
            background: #d4edda;
            color: #155724;
        }

        .fail {
            background: #f8d7da;
            color: #721c24;
        }

        pre {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
        }

        h1 {
            color: #333;
        }
    </style>
</head>

<body>
    <h1>ðŸ§ª Fun-FP-JS Browser Test</h1>
    <div id="results"></div>

    <script src="dist/fun-fp.js"></script>
    <script>
        const results = document.getElementById('results');
        let passed = 0, failed = 0;

        function test(name, fn) {
            const div = document.createElement('div');
            div.className = 'test';
            try {
                fn();
                div.className += ' pass';
                div.textContent = `âœ… ${name}`;
                passed++;
            } catch (e) {
                div.className += ' fail';
                div.textContent = `âŒ ${name}: ${e.message}`;
                failed++;
            }
            results.appendChild(div);
        }

        function assert(condition, message) {
            if (!condition) throw new Error(message || 'Assertion failed');
        }

        function assertEquals(a, b) {
            if (JSON.stringify(a) !== JSON.stringify(b)) {
                throw new Error(`Expected ${JSON.stringify(b)}, got ${JSON.stringify(a)}`);
            }
        }

        // Destructure from global FunFP
        const { Maybe, Either, Task, Functor, Monad, compose, pipe, trampoline, Free, extra } = FunFP;

        // === Tests ===
        test('FunFP is defined', () => {
            assert(typeof FunFP === 'object', 'FunFP should be an object');
        });

        test('Maybe.of creates Just', () => {
            const m = Maybe.of(42);
            assert(Maybe.isJust(m), 'should be Just');
            assertEquals(m.value, 42);
        });

        test('Maybe.Nothing creates Nothing', () => {
            const m = Maybe.Nothing();
            assert(Maybe.isNothing(m), 'should be Nothing');
        });

        test('Either.Right creates Right', () => {
            const e = Either.Right(42);
            assert(Either.isRight(e), 'should be Right');
        });

        test('Either.Left creates Left', () => {
            const e = Either.Left('error');
            assert(Either.isLeft(e), 'should be Left');
        });

        test('Functor.map works on Array', () => {
            const arr = [1, 2, 3];
            const result = Functor.types.ArrayFunctor.map(x => x * 2, arr);
            assertEquals(result, [2, 4, 6]);
        });

        test('compose works', () => {
            const double = x => x * 2;
            const addOne = x => x + 1;
            const composed = compose(double, addOne);
            assertEquals(composed(5), 12);
        });

        test('pipe works', () => {
            const addOne = x => x + 1;
            const double = x => x * 2;
            const square = x => x * x;
            const result = pipe(addOne, double, square)(5);
            assertEquals(result, 144);
        });

        test('Free.trampoline works', () => {
            const { Thunk } = Free;
            const factorial = n => {
                const go = (n, acc) =>
                    n <= 1
                        ? Thunk.done(acc)
                        : Thunk.suspend(() => go(n - 1, n * acc)).flatMap(x => x);
                return trampoline(go(n, 1));
            };
            assertEquals(factorial(5), 120);
        });

        test('extra.path works', () => {
            const data = { user: { name: 'Alice' } };
            const result = extra.path('user.name')(data);
            assert(Either.isRight(result), 'should be Right');
            assertEquals(result.value, 'Alice');
        });

        test('extra.template works', () => {
            const result = extra.template('Hello, {{name}}!', { name: 'World' });
            assertEquals(result, 'Hello, World!');
        });

        test('Task.of works', () => {
            const task = Task.of(42);
            assert(Task.isTask(task), 'should be Task');
        });

        // Summary
        const summary = document.createElement('pre');
        summary.textContent = `
=== Test Summary ===
Passed: ${passed}
Failed: ${failed}
Total:  ${passed + failed}
`;
        results.insertBefore(summary, results.firstChild);
    </script>
</body>

</html>